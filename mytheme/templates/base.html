{% set current_lang = DEFAULT_LANG %}
{% if LANG is defined and LANG %}
    {% set current_lang = LANG %}
{% elif lang is defined and lang %}
    {% set current_lang = lang %}
{% elif article is defined and article %}
    {% set current_lang = article.lang or DEFAULT_LANG %}
{% elif page is defined and page %}
    {% set current_lang = page.lang or DEFAULT_LANG %}
{% endif %}
<!DOCTYPE html>
<html lang="{% block html_lang %}{{ current_lang }}{% endblock html_lang %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ SITENAME }}{% endblock title %}</title>
    <script src="{{ SITEURL }}/theme/js/theme-toggle.js"></script>

    <link rel="stylesheet" href="{{ SITEURL }}/theme/css/variables.css">
    <link rel="stylesheet" href="{{ SITEURL }}/theme/css/theme.css">
    
    {% block head %}{% endblock head %}
</head>
<body>

    <div class="container">
        <header>
            {% set home_href = SITEURL ~ '/index-' ~ current_lang ~ '.html' %}
            <h1><a href="{{ home_href }}" style="text-decoration:none; color: inherit;">{{ SITENAME }}</a></h1>
            <nav>
                <div class="nav-links">
                    <a href="{{ home_href }}">{{ (TEXTS or {}).get(current_lang, {}).get('nav_posts', 'Posts') }}</a>

                    {% for p in pages %}
                        {% set ns = namespace(target=None) %}
                        {% set page_lang = p.lang or DEFAULT_LANG %}
                        {% if page_lang == current_lang %}
                            {% set ns.target = p %}
                        {% else %}
                            {% for translation in p.translations or [] %}
                                {% if translation.lang == current_lang %}
                                    {% set ns.target = translation %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        {% if ns.target and ns.target.slug != 'index' and ns.target.status != 'hidden' %}
                            <a href="{{ SITEURL }}/{{ ns.target.url }}">{{ ns.target.title }}</a>
                        {% endif %}
                    {% endfor %}
                </div>

                <div class="nav-controls">
                    <button type="button"
                            id="theme-toggle"
                            class="theme-toggle"
                            aria-pressed="false"
                            aria-label="Switch to dark mode">
                        Dark
                    </button>

                    <div class="language-switcher">
                        {% set translations = [] %}
                        {% if page is defined and page %}
                            {% set translations = page.translations or [] %}
                        {% elif article is defined and article %}
                            {% set translations = article.translations or [] %}
                        {% endif %}

                        {% for translation in translations %}
                            <a href="{{ SITEURL }}/{{ translation.url }}" hreflang="{{ translation.lang }}">{{ translation.lang|upper }}</a>
                        {% endfor %}
                    </div>
                </div>
            </nav>
        </header>

        <main>
            {% block content %}
            {% endblock content %}
        </main>
    </div>
</body>
</html>
