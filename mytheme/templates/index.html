{% extends "base.html" %}

{% block content %}
{% set current_lang = DEFAULT_LANG %}
{% if page is defined and page %}
    {% set current_lang = page.lang or DEFAULT_LANG %}
{% elif LANG is defined and LANG %}
    {% set current_lang = LANG %}
{% elif lang is defined and lang %}
    {% set current_lang = lang %}
{% endif %}
{% set t = (TEXTS or {}).get(current_lang, {}) %}

    {% if page is defined and page and page.content %}
    <section class="home-intro">
        {{ page.content }}
    </section>
    {% endif %}

    {% set source_articles = articles if articles is defined else [] %}
    {% set ns = namespace(items=[], seen=[]) %}
    {% for article in source_articles %}
        {% if article.url not in ns.seen %}
            {% set ns.items = ns.items + [article] %}
            {% set ns.seen = ns.seen + [article.url] %}
        {% endif %}
        {% for translation in article.translations or [] %}
            {% if translation.url not in ns.seen %}
                {% set ns.items = ns.items + [translation] %}
                {% set ns.seen = ns.seen + [translation.url] %}
            {% endif %}
        {% endfor %}
    {% endfor %}

    {% set ordered_items = ns.items | sort(attribute='date', reverse=True) %}
    {% set display_items = ordered_items %}
    {% if DEFAULT_PAGINATION %}
        {% set display_items = ordered_items[:DEFAULT_PAGINATION] %}
    {% endif %}

    {% for article in display_items %}
    <article class="post-list">
        <h2><a href="{{ SITEURL }}/{{ article.url }}">{{ article.title }}</a></h2>
        <p class="post-meta">{{ article.date|format_date(current_lang) }}</p>
        <p class="summary">{{ article.summary }}</p>
    </article>
    {% endfor %}
{% endblock %}
